
http://www.l99.com/media_personal_following.action?nowPage=1&showData=38

http://www.l99.com/media_personal_recommend.action

命名　　xxxShare

读请求
com.l99.web.media.EditMediaAction

com.l99.service.share.MediaPostWeightShare

没体　　MediaPostWeightShare.findMediaByTime(sessId, timeStage, mediaId, boardType, showData);
第一次　SELECT * FROM media_post_weight WHERE mediaWeight >20 ORDER BY indexId DESC,updateTime DESC LIMIT ? 
	SELECT * FROM media_post_weight WHERE mediaId =?   
第二次　SELECT * FROM media_post_weight WHERE mediaWeight >20 AND updateTime<'2012-02-20 23:58:32'  ORDER BY indexId DESC,updateTime DESC LIMIT ? 
List<MediaPostWeight>


private static List<MediaLifeixClassic> transMediaLifeixClassic(Long sessId,List<MediaPostWeight> weights,boolean commentFlag )
	getBoardByType(post.getBoardData(), post.getBoardType());
	select * from dashboard_basic where dashboardType=? and dashboardData=? and rebolgFlag=false
	select * from dashboard_text where textId=?

	

有类型的　

第一次　SELECT p.* FROM media_post_type t LEFT JOIN media_post_weight p ON t.mediaId =p.mediaId WHERE  p.mediaWeight >20 AND t.typeWeight>5 AND t.typeId=5  ORDER BY p.indexId DESC,p.updateTime DESC LIMIT ? 

　　t.type in (什么时候有)

品　
第一次　SELECT * FROM media_post_weight WHERE likeNO > ? ORDER BY likeTime DESC LIMIT ? 　　　（５，３０）


品品

	select * from dashboard_basic where dashboardId=?
	if(board.getDashboardType()==DashboardType.APP)　　SELECT * FROM dashboard_app WHERE appId=?

	SELECT * FROM　comment WHERE accountId=? AND rootId=? AND type=? AND status=?
	INSERT INTO comment(rootId,accountId,content,createTime,parentId,num,type,replyId,ipAddress,pos,appUrl,replyAccount,status,delFlag,source,boardId,lng,lat,replyContent,conType) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)

	// 记录+1  
	{call spAddNotesNumber(?,?)}
	UPDATE dashboard_photo SET notesNum = notesNum +1 WHERE photoId = _targetId

	// 记录+1
	commentDaoImpl.addNotesNum(comment.getRootId(), comment.getType());
			
	// 消息提醒
	EventCommentHandler.commentFeed(comment);
	// 更新like缓存
	deleteCustomizeObjectInCache(MemcacheItemType.DASHBOARD_USER_LIKE, sessId + "_" + comment.getType() + "_" + comment.getRootId());
			
	// 更新统计缓存
	deleteCustomizeObjectInCache(MemcacheItemType.DASHBOARD_BAR_LIKES, sessId);
			
	// 更新内容缓存
	DashboardShare.updataCache(board.getDashboardType(), board.getDashboardData());

	// 计算音乐积分
	select * from dashboard_music where musicId=?
	update dashboard_music_Integral set musicIntegral=?,musicLevel=?,musicAdded=? where accountId=?
	// 用户积分
	if(comment.getReplyAccount() > 0l)    getReplyAccount ??



	CommFeed    comment.getType()  borderType   L99CommentType ??
	INSERT INTO account_level (accountId,level,exp,status,trueName,vip,boxExp,updateTime) VALUES(?,?,?,?,?,?,?,now())
	SELECT * FROM account_level_type WHERE expType=?
	SELECT * FROM account_level_trans WHERE accountId=? AND expType=?
	(INSERT INTO account_level_trans (accountId,expTotal,expType,expAdd,expTime) VALUES(?,?,?,?,?))
	UPDATE account_level_trans SET expTotal=?,expAdd=?,expTime=? WHERE accountId=? AND expType=?

重飞
	insert into dashboard_basic(accountId,parentId,parentDashboard,dashboardType,dashboardData,dashboardTitle,dashboardAbstract,permissionType,dashboardTime,lng,lat,dashboardTag,sourceClient,sourceUrl,dashboardFlag,rebolgFlag,ztFlag,blockFlag) values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
		



没体　　　media_post_weight　　　                dashboard_basic　　dashboard_XXX
类型	media_post_type media_post_weight
品	media_post_weight　(likeNo)



品　　comment　　　dashboard_XXX (No.)  feed_my   dashboard_music_Integral  account_level_trans
重飞　　dashboard_basic
评论　　dashboard_basic　












立方块　请求

com.l99.web.media.EditMediaPersonAction
com.l99.service.person.PersonalRecommendService

logList   
	if (stickFlag)stickSql =" WHERE stickId >0 ";
	select t.*,a.name,a.l99NO,a.photoPath,a.mobilePhoto from (select * from media_person_recommend_log "+stickSql+" order by logId desc limit "+LOG_NUM+") t left join account a on t.accountId=a.accountId group by t.accountId LIMIT ?";

load()

	PersonalRecommendService.public List<PersonalRecommendPeople> findRecommendPeopleOrderByTime(String time,int limit)
	SELECT r.*,a.name,a.l99NO,a.photoPath,a.mobilePhoto FROM media_person_recommend r LEFT JOIN account a ON r.accountId = a.accountId WHERE (r.status =0 OR r.status=2) AND r.stickNO >0 AND r.updateTime <'2012-02-14 17:17:41'  ORDER BY r.updateTime DESC LIMIT ?

	select stickId,count(*) from media_person_recommend_log where targetId = ? group by stickId

	SELECT * FROM follow_log WHERE accountId=? AND targetAccount=?


load_user()
	SELECT a.accountId,a.name,a.l99NO,a.photoPath,a.mobilePhoto FROM account_level l LEFT JOIN account a ON a.accountId = l.accountId WHERE a.status >1 AND length(a.photoPath)>20  ORDER BY l.updateTime DESC LIMIT ?
	select * from account_profile where accountId=?

load_editor()
	MediaUserWeightService.public static List<MediaUserTypeWeight> findMediaUserOrderByTime(String time,int limit)
	SELECT w.editorId,a.accountId,a.name,a.l99NO,a.photoPath FROM media_user_weight w LEFT JOIN account a ON a.accountId = w.accountId WHERE w.editorId >0 AND w.userStatus =0  ORDER BY w.updateTime DESC LIMIT ?
	SELECT * FROM media_user_type where accountId =? AND level >0 AND typeWeight >0



推荐

com.l99.service.person.PersonalRecommendService.recommendUser（）
　　PersonalRecommend   SELECT * FROM media_person_recommend WHERE accountId =?
	INSERT INTO media_person_recommend (accountId,lastRecommendId,recommendNO,stickNO,stickTypes,createTime,updateTime,status) VALUES (?,?,?,?,?,?,?,?)
    是否用过　　SELECT s.stickId FROM　media_person_recommend_log l LEFT JOIN directory_stick s ON l.stickId = s.stickId WHERE l.accountId =? AND s.price=0 AND l.createTime > ?
	INSERT INTO media_person_recommend_log (accountId, targetId, stickId, comment, createTime, status, cardFlag) VALUES (?,?,?,?,?,?,?)

		（关于免费牌的逻辑）
	updateMediaUserType（targetId,accountId,stickId）
		SELECT * FROM media_user_type WHERE accountId=? AND typeId =?　　　media_user_type（用户，牌ID, [谁推荐了]）
　　　　

Feed
	SELECT * FROM feed_my_type WHERE typeId = ?
	MyFeedService.addMyFeed(myfeed);

	RelationShip
	SELECT * FROM follow_log WHERE accountId=? AND targetAccount=?

	INSERT INTO feed_my (`typeId` , `icon` , `actorId` , `createTime` , `hash_template` , `hash_data` , `title_template` , `title_data` , `body_template` , `body_data` , `isRead` , `accountId`) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)

解锁精灵
	select t.*,l.lng,l.lat,l.country,l.provice,l.city,l.remark,l.address,l.fullAddress,v.businessId from townfile_local t left join tape_local l on l.id = t.localId left join business_village v on v.localId = t.localId where t.localId =? 

	select * from townfile_medal_main where medalId=?
	L36 public static MyFeed createFeedByTypeAndTarget(Long feedType, Account actor, Long targetId, Long accountId)


关注
http://www.l99.com/EditFriend_follow.action?targetId=707506
	com.l99.service.friend.RelationShipService.addFollowShip(getSessionAccount(), targetId, true)
	{call spAddFollowShip(?,?)}
	follow_log



logList
media_person_recommend_log　　account

load()
media_person_recommend　　account　

load_user()
account_level　　account

load_editor()
media_user_weight　　account

推荐
media_person_recommend　　media_person_recommend_log　　media_user_type
feed_my　



计算用户积分
先看看有没有AccountLevel，没有就创建一个。
加上应该加的积分。（每天有上限）

accountLevel　





























